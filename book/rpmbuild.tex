\hypertarget{rpmbuild}{\chapter{Инструмент rpmbuild}}\label{chapter-rpmbuild}

\markboth{Инструмент rpmbuild}{Инструмент rpmbuild }

\Emph{rpmbuild} --- утилита сборки rpm-пакета из набора подготовленных файлов. Сборка осуществляется
в локальном окружении операционной системы, то есть в процессе сборки используются пакеты
установленные в системе. rpmbuild позволяет собрать пакет с исходными данными(или в частном
случае пакеты с исходным кодом программ) и пакеты с бинарным содержимым.

Для работы с утилитой необходимо установить пакет rpm-build:

\begin{verbatim}
$ apt-get install rpm-build
\end{verbatim}

Общий вид структуры вызова утилиты:

\begin{verbatim}
$ rpmbuild [ПАРАМЕТРЫ]
\end{verbatim}

Для подробной информации вызовите справку командой:

\begin{verbatim}
$ rpmbuild --help
\end{verbatim}

Параметры сборки \Emph{rpmbuild}:
\begin{verbatim}
-ba - Сборка исходного и двоичного пакета по файлу спецификации
-bb - Cборка только бинарного пакета по файлу спецификации
-bs - Cборка только пакета c исходными данными(src.rpm) по файлу спецификации
-tb - Сборка бинарного пакета из tar-архива
-ts - Сборка исходного пакета из tar-архива
-bl - Проверить список файлов в каталогах дерева окружения и вывести ошибки, если отсутствуют необходимые файлы
--rmsource - Удаление исходных файлов после завершения сборки
--rmspec - Удаление файла спецификации после завершения сборки
\end{verbatim}

Утилита предполагает наличие подготовленной структуры каталогов для сборки - дерево каталогов.
(см.\,\hyperlink{3.4}{3.4 "Рабочее пространство для сборки RPM-пакетов"}). По умолчанию используется
каталог \Sys{$\sim$/RPM}.

\begin{verbatim}
$ tree ~/RPM
/home/user/RPM
├── BUILD
├── RPMS
├── SOURCES
├── SPECS
└── SRPMS

5 directories, 0 files
\end{verbatim}

Выбранные для сборки исходные данные необходимо упаковать в \Sys{.tar} архив:

\begin{verbatim}
$ tar -cvf <ИМЯ ФАЙЛА АРХИВА>.tar <КАТАЛОГ ИСХОДНЫХ ДАННЫХ>/
\end{verbatim}

Архив с исходными данными для сборки нужно поместить в каталог \Sys{./RPM/SOURCES/},
подготовленный \Sys{.spec} файл с инструкциями поместить в каталог \Sys{./RPM/SPECS}.

\begin{verbatim}
$ cp <ИМЯ ФАЙЛА АРХИВА>.tar ~/RPM/SOURCES/<ИМЯ ФАЙЛА АРХИВА>.tar && \
cp <ИМЯ SPEC-ФАЙЛА>.spec ./RPM/SPECS/<ИМЯ SPEC-ФАЙЛА>.spec
\end{verbatim}

Прмер сборки бинарного пакета \Sys{.rpm}:
\begin{verbatim}
$ rpmbuild -bb ~/RPM/SPECS/<ИМЯ SPEC-ФАЙЛА>.spec
\end{verbatim}
После успешного выполнения процесса сборки, бинарные пакеты \Sys{.rpm} помещаются в каталог $\sim$/RPM/RPMS/

\hypertarget{rpmbuild-exampl-src}{Пример сборки пакета с исходными данными \Sys{.src.rpm}}:
\begin{verbatim}
$ rpmbuild -bs ~/RPM/SPECS/<ИМЯ SPEC-ФАЙЛА>.spec
\end{verbatim}
После успешного выполнения процесса сборки, пакеты \Sys{.src.rpm} помещаются в каталог $\sim$/RPM/SRPMS/

Рассмотрены два базовых сценария сборки пакета. Для получения различных результатов можно комбинировать ключи.
Например для сборки и бинарного пакета и пакета с исходными данными можно использовать ключ \Sys{-ba}.
Полученные пакеты можно переносить и инсталлировать на различные компьютеры любым доступным способом.
В общем виде сборка пакета состоит из этапов:
\begin{itemize}
\item Установить пакет rpm-build;
\item Подготовить окружение сборки;
\item Сформировать исходные данные;
\item Упаковать исходные данные для сборки в \Sys{.tar} архив;
\item Подготовить файл спецификации для сборки \Sys{.spec};
\item Разместить подготовленные файлы в каталогах окружения сборки;
\item Запустить локальную сборку.
\end{itemize}

Сборка пакетов в локальном окружении операционной системы вызывает некоторые неудобства.
Приходится вручную раскладывать файлы в структуре каталогов $\sim$/RPM. При изменении
исходных данных приходится заново создавать архив. Работа в локальном окружении потенциально
может вызвать проблемы безопасности в случае сборки и исполнения заранее не проверенных исходных
данных собираемых программ и компонентов. Все дополнительные компоненты необходимые
в процессе сборки, необходимо устанавливать в операционную систему так же в ручную.
В случае разработки дистрибутива операционной системы такие недостатки неприемлемы.
Поэтому разработчики дистрибутивов операционных систем создают свои собственные инструменты,
позволяющие исключить недостатки локальной сборки пакетов.
