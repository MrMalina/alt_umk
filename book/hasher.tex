\chapter{Инструмент Hasher}\label{chapter-hasher}
\Emph{Hasher} --- инструмент для сборки пакетов с использованием минимальной контролируемой среды в \Sys{chroot}. \Sys{Hasher} опирается на системный вызов \Sys{chroot} и создает изолированную среду для сборки отдельного пакета утилитой \Sys{rpm-build}.

\Sys{Hasher} облегчает поддержание сборочных зависимостей и позволяет собирать пакеты для разных дистрибутивов. \Sys{Hasher} проверяет пакеты с помощью утилиты \Sys{sisyphus\_check} и создает локальный \Sys{APT}-репозиторий с результатами сборки.

Для подготовки сборочного окружения \Sys{hasher} берет пакеты как из удалённых репозиториев, настроенных в основной системы, так и из локального репозитория (\Sys{~/hasher/repo/}), в который попадают ранее собранные пакеты.

Так же \Sys{hasher} удобен для отладки процесса сборки. Если сборка пакета прервалась, выполните команду \Sys{hsh-shell}, чтобы попасть в терминал \Sys{chroot}, исправьте ошибку и продолжайте сборку с прерванного этапа.


\section{Справочная страница Hasher}
Возможности \Sys{Hasher} задокументированы в инструкциях\footnote{\href{http://uneex.ru/static/AltlinuxOrg_Hasher/}{http://uneex.ru/static/AltlinuxOrg\_Hasher/}} к пакетам \Sys{hasher} и \Sys{hasher-priv}. Для вызова справочной информации по \Sys{hasher} наберите в консоли \Sys{man package}:
\begin{verbatim}
	$ man hsh
	
	HASHER(7)                          ALT Linux                         HASHER(7)
	
	NAME
	hasher - modern safe package building technology
	
	SYNOPSIS
	hsh [options] <path-to-workdir> <package>...
	...
\end{verbatim} 

\begin{verbatim}
	$ man hasher-priv
	
	HASHER-PRIV(8)          System Administration Utilities         HASHER-PRIV(8)
	
	NAME
	hasher-priv - privileged helper for the hasher project
	
	SYNOPSIS
	hasher-priv [options] <args>
	...
\end{verbatim}

Это достаточно подробная инструкция по использованию утилиты \Sys{hasher}. Здесь вы найдёте полное описание, опции и флаги, содержимое рабочего каталога. 


\section{Монтирование файловых систем внутри Hasher}
\Sys{Hasher} умеет монтировать внутрь \Sys{hasher}-контейнера точки монтирования и виртуальные файловые системы из основной машины\footnote{\href{https://www.altlinux.org/Hasher/\%D0\%A0\%D1\%83\%D0\%BA\%D0\%BE\%D0\%B2\%D0\%BE\%D0\%B4\%D1\%81\%D1\%82\%D0\%B2\%D0\%BE\#\%D0\%9C\%D0\%BE\%D0\%BD\%D1\%82\%D0\%B8\%D1\%80\%D0\%BE\%D0\%B2\%D0\%B0\%D0\%BD\%D0\%B8\%D0\%B5_\%D1\%84\%D0\%B0\%D0\%B9\%D0\%BB\%D0\%BE\%D0\%B2\%D1\%8B\%D1\%85_\%D1\%81\%D0\%B8\%D1\%81\%D1\%82\%D0\%B5\%D0\%BC_\%D0\%B2\%D0\%BD\%D1\%83\%D1\%82\%D1\%80\%D0\%B8_hasher}{https://www.altlinux.org/Hasher/Руководство}}. Этот механизм применяется в тех случаях, когда собираемому приложению для сборки требуется доступ к ресурсам основной машины, которые \Sys{Hasher} не предоставляет по умолчанию. Например, виртуальная файловая система \Sys{/proc} или \Sys{/dev/pts}, которых по умолчанию нет в \Sys{hasher}-контейнере. Файловая система \Sys{/proc} получает информацию о состоянии и конфигурации ядра и системы.

Для монтирования файловой системы следует:
\begin{enumerate}
	\item В файле \Sys{/etc/hasher-priv/fstab} описать файловую систему.
	\item В файле \Sys{/etc/hasher-priv/system} указать файловую систему с помощью опции \Sys{allowed\_mointpoints}.
	\item Указать файловую систему либо при запуске \Sys{Hasher} в опции \Sys{--mountpoints}, либо в конфигурационном файле \Sys{~/.hasher/config} в ключе \Sys{known\_mountpoints}.
	\item Прописать необх/одимую файловую систему в \Sys{SPEC}-файле в теге \Sys{BuildReq}, либо в списке зависимостей.
\end{enumerate} 